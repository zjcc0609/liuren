<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>å°å…­å£¬Â·çµæ„Ÿç¥è¯¾</title>
    
    <!-- æ ¸å¿ƒåº“ CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #F5F2EB;
        }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        select {
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
    </style>
</head>
<body class="text-stone-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- é…ç½®åŒºåŸŸ (å·²æ›´æ–°ä¸ºç”¨æˆ·æŒ‡å®šé…ç½®) ---
        
        const DEFAULT_API_KEY = "sk-LIwQnLkg8dnUU0X74vwGpE0o798i0N4WWaeyoikHgQxwU5fl"; 
        const API_BASE_URL = "https://hiapi.online/v1"; 

        // --- åŸºç¡€æ•°æ®å®šä¹‰ ---
        
        const LUNAR_MONTHS = ['æ­£æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'å†¬æœˆ', 'è…Šæœˆ'];
        const LUNAR_DAYS = [
            'åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
            'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
            'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'
        ];

        const EARTHLY_BRANCHES = [
            { name: 'å­æ—¶', range: '23:00 - 01:00', idx: 1 },
            { name: 'ä¸‘æ—¶', range: '01:00 - 03:00', idx: 2 },
            { name: 'å¯…æ—¶', range: '03:00 - 05:00', idx: 3 },
            { name: 'å¯æ—¶', range: '05:00 - 07:00', idx: 4 },
            { name: 'è¾°æ—¶', range: '07:00 - 09:00', idx: 5 },
            { name: 'å·³æ—¶', range: '09:00 - 11:00', idx: 6 },
            { name: 'åˆæ—¶', range: '11:00 - 13:00', idx: 7 },
            { name: 'æœªæ—¶', range: '13:00 - 15:00', idx: 8 },
            { name: 'ç”³æ—¶', range: '15:00 - 17:00', idx: 9 },
            { name: 'é…‰æ—¶', range: '17:00 - 19:00', idx: 10 },
            { name: 'æˆŒæ—¶', range: '19:00 - 21:00', idx: 11 },
            { name: 'äº¥æ—¶', range: '21:00 - 23:00', idx: 12 }
        ];

        const SIX_GODS = [
            { name: 'å¤§å®‰', element: 'æœ¨', color: 'text-green-700', bg: 'bg-green-50', border: 'border-green-200', summary: 'å¤§å‰Â·èº«ä¸åŠ¨', poem: 'å¤§å®‰äº‹äº‹æ˜Œï¼Œæ±‚è´¢åœ¨å¤æ–¹ï¼Œå¤±ç‰©å»ä¸è¿œï¼Œå®…èˆä¿å®‰åº·ã€‚', desc: 'ä¸‡äº‹å¤§å‰ï¼Œå®œé™ä¸å®œåŠ¨ã€‚ç›®å‰å±€åŠ¿ç¨³å›ºï¼Œä¸å¿…æ€¥äºæ±‚å˜ã€‚', lost: 'ä¸œè¥¿æ²¡ä¸¢ï¼Œå°±åœ¨é™„è¿‘ã€‚å¯èƒ½è¢«å®¶é‡Œçš„å™¨ç‰©é®ç›–äº†ï¼Œæˆ–åœ¨è¥¿å—æ–¹ã€‚', score: 90 },
            { name: 'ç•™è¿', element: 'æ°´', color: 'text-slate-700', bg: 'bg-slate-50', border: 'border-slate-200', summary: 'ä¸­å‡¶Â·äººæœªå½’', poem: 'ç•™è¿äº‹éš¾æˆï¼Œæ±‚è°‹æ—¥æœªæ˜ï¼Œå®˜äº‹åªå®œç¼“ï¼Œå»è€…æœªå›ç¨‹ã€‚', desc: 'å‡¡äº‹æ‹–å»¶ï¼Œé˜»ç¢è¾ƒå¤šã€‚äº‹æƒ…ä¸ä¼šé©¬ä¸Šæœ‰ç»“æœï¼Œéœ€è¦è€å¿ƒç­‰å¾…ã€‚', lost: 'ä¸œè¥¿å¾ˆéš¾æ‰¾ã€‚å¯èƒ½æ‰åœ¨è·¯ä¸Šäº†ï¼Œæˆ–è€…è¢«ç»†é•¿ä¹‹ç‰©ç¼ ä½ã€‚', score: 40 },
            { name: 'é€Ÿå–œ', element: 'ç«', color: 'text-red-600', bg: 'bg-red-50', border: 'border-red-200', summary: 'ä¸­å‰Â·äººå³è‡³', poem: 'é€Ÿå–œå–œæ¥ä¸´ï¼Œæ±‚è´¢å‘å—è¡Œï¼Œå¤±ç‰©ç”³åˆæœªï¼Œé€¢äººè·¯ä¸Šå¯»ã€‚', desc: 'å‰åˆ©ä¸”å¿«é€Ÿã€‚æœ‰å–œè®¯ä¼ æ¥ï¼Œåˆ©äºæ€¥äº‹ã€è€ƒè¯•ã€é¢è¯•ã€‚', lost: 'é©¬ä¸Šå°±èƒ½æ‰¾åˆ°ã€‚å¾€æ­£å—æ–¹å‘æ‰¾ï¼Œåœ¨æ˜¾çœ¼ã€æ˜äº®å¤„ã€‚', score: 85 },
            { name: 'èµ¤å£', element: 'é‡‘', color: 'text-orange-700', bg: 'bg-orange-50', border: 'border-orange-200', summary: 'å°å‡¶Â·å®˜äº‹å‡¶', poem: 'èµ¤å£ä¸»å£èˆŒï¼Œå®˜éåˆ‡è¦é˜²ï¼Œå¤±ç‰©é€Ÿé€Ÿè®¨ï¼Œè¡Œäººæœ‰æƒŠæ…Œã€‚', desc: 'å¤šå£èˆŒæ˜¯éï¼Œå®¹æ˜“å‘ç”Ÿäº‰åµã€‚å¿Œè®³è°ˆåˆ¤ã€ç­¾åˆåŒã€‚', lost: 'ä¸œè¥¿å¯èƒ½å·²ç»æŸåï¼Œæˆ–è€…è¢«äººæ‹¿èµ°ï¼Œææœ‰äº‰æ‰§ã€‚', score: 30 },
            { name: 'å°å‰', element: 'æœ¨', color: 'text-emerald-600', bg: 'bg-emerald-50', border: 'border-emerald-200', summary: 'å°å‰Â·äººæ¥å–œ', poem: 'å°å‰æœ€å‰æ˜Œï¼Œè·¯ä¸Šå¥½å•†é‡ï¼Œé˜´äººæ¥æŠ¥å–œï¼Œå¤±ç‰©åœ¨å¤æ–¹ã€‚', desc: 'å°å°çš„å‰åˆ©ï¼Œé¡ºç•…ã€‚é€‚åˆè°ˆåˆä½œã€äº¤æ˜“ã€æ„Ÿæƒ…ã€‚', lost: 'èƒ½æ‰¾åˆ°ã€‚åœ¨è¥¿å—æ–¹ï¼Œæˆ–è€…æ°´è¾¹ã€è‰åœ°æ—ï¼Œåšç¡¬ç‰©ä¹‹ä¸‹ã€‚', score: 75 },
            { name: 'ç©ºäº¡', element: 'åœŸ', color: 'text-stone-600', bg: 'bg-stone-50', border: 'border-stone-200', summary: 'å¤§å‡¶Â·éŸ³ä¿¡ç¨€', poem: 'ç©ºäº¡äº‹ä¸é•¿ï¼Œé˜´äººå°ä¹–å¼ ï¼Œæ±‚è´¢æ— åˆ©ç›Šï¼Œè¡Œäººæœ‰ç¾æ®ƒã€‚', desc: 'å¤§å‡¶ï¼Œè¯¸äº‹è½ç©ºã€‚æ‰¿è¯ºå¤šè™šå‡ï¼Œä¸è¦æŠ±æœ‰å¹»æƒ³ï¼ŒåŠæ—¶æ­¢æŸã€‚', lost: 'å½»åº•ä¸¢å¤±ã€‚ä¸ç”¨æ‰¾äº†ï¼Œå¯èƒ½æ‰è¿›äº†æ·±å‘æˆ–æš—å¤„æ°´é‡Œã€‚', score: 10 },
        ];

        function App() {
            const [mode, setMode] = useState('general');
            const [inputMethod, setInputMethod] = useState('date'); // 'date' | 'random'
            const [query, setQuery] = useState('');
            const [result, setResult] = useState(null);
            const [loading, setLoading] = useState(false);
            
            const [lunarMonth, setLunarMonth] = useState(1);
            const [lunarDay, setLunarDay] = useState(1);
            const [hourIndex, setHourIndex] = useState(0);
            
            const [aiAnalysis, setAiAnalysis] = useState('');
            const [aiLoading, setAiLoading] = useState(false);

            useEffect(() => {
                const now = new Date();
                const h = now.getHours();
                const correctHourIdx = Math.floor((h + 1) / 2) % 12;
                setHourIndex(correctHourIdx);

                try {
                    const formatter = new Intl.DateTimeFormat('zh-CN', { calendar: 'chinese', day: 'numeric', month: 'numeric' });
                    const parts = formatter.formatToParts(now);
                    const mPart = parts.find(p => p.type === 'month');
                    const dPart = parts.find(p => p.type === 'day');
                    
                    if (mPart && dPart) {
                        setLunarMonth(parseInt(mPart.value));
                        setLunarDay(parseInt(dPart.value));
                    }
                } catch (e) {
                    console.log("å†œå†è½¬æ¢å¤±è´¥ï¼Œå›é€€é»˜è®¤å€¼", e);
                }
            }, []);

            const calculate = (m, d, hIdx, isRandom = false) => {
                if (!m || !d) return;
                if (!isRandom) setLoading(true);
                
                setTimeout(() => {
                    const mVal = parseInt(m);
                    const dVal = parseInt(d);
                    const hVal = parseInt(hIdx) + 1;

                    const mIndex = (mVal - 1) % 6;
                    const dIndex = (mIndex + dVal - 1) % 6;
                    const hFinalIndex = (dIndex + hVal - 1) % 6;

                    setResult({
                        final: SIX_GODS[hFinalIndex],
                        month: SIX_GODS[mIndex],
                        day: SIX_GODS[dIndex]
                    });
                    setLoading(false);
                    setAiAnalysis('');
                }, isRandom ? 500 : 800);
            };

            const handleRandom = () => {
                setLoading(true);
                const rM = Math.floor(Math.random() * 12) + 1;
                const rD = Math.floor(Math.random() * 30) + 1;
                const rH = Math.floor(Math.random() * 12);
                setLunarMonth(rM);
                setLunarDay(rD);
                setHourIndex(rH);
                calculate(rM, rD, rH, true);
            }

            const callAI = async () => {
                if (!DEFAULT_API_KEY) {
                    setAiAnalysis("è¯·å…ˆé…ç½® API Keyã€‚");
                    return;
                }

                setAiLoading(true);
                const hName = EARTHLY_BRANCHES[hourIndex].name;
                
                // ä¿®æ”¹æç¤ºè¯ï¼šå¼ºè°ƒç™½è¯æ–‡ã€ç»“åˆç”¨æˆ·è¾“å…¥ã€å…·ä½“å»ºè®®
                const prompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šå°å…­å£¬çš„è§£å¦ä¸“å®¶ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ä¸ºç”¨æˆ·è§£è¯»ï¼š

ã€å¦è±¡ä¿¡æ¯ã€‘ï¼š${result.final.name}ï¼ˆäº”è¡Œå±${result.final.element}ï¼Œ${result.final.summary}ï¼‰
ã€å¦è¾åŸæ–‡ã€‘ï¼š${result.final.poem}
ã€æµ‹ç®—æ—¶é—´ã€‘ï¼šå†œå†${LUNAR_MONTHS[lunarMonth-1]}${LUNAR_DAYS[lunarDay-1]} ${hName}
ã€æµ‹ç®—ç±»å‹ã€‘ï¼š${mode === 'general' ? 'å‰å‡¶/åŠäº‹' : 'å¯»ç‰©'}
ã€ç”¨æˆ·æ‰€é—®ã€‘ï¼š${query ? query : 'ï¼ˆç”¨æˆ·æœªå…·ä½“è¯´æ˜ï¼Œè¯·åšç»¼åˆè¿åŠ¿åˆ†æï¼‰'}

è¯·æŒ‰ç…§ä»¥ä¸‹è¦æ±‚è¿›è¡Œè§£è¯»ï¼š
1. **å¿…é¡»ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„å¤§ç™½è¯**ï¼Œä¸è¦ä½¿ç”¨æ™¦æ¶©çš„æ–‡è¨€æ–‡ï¼Œå°±åƒè€æœ‹å‹èŠå¤©ä¸€æ ·ã€‚
2. **ç´§å¯†ç»“åˆç”¨æˆ·çš„é—®é¢˜**ï¼ˆ${query || 'ç»¼åˆè¿åŠ¿'}ï¼‰è¿›è¡Œå…·ä½“åˆ†æã€‚æ¯”å¦‚ç”¨æˆ·é—®è´¢è¿ï¼Œå°±é‡ç‚¹è®²è´¢è¿ï¼›é—®æ„Ÿæƒ…ï¼Œå°±é‡ç‚¹è®²æ„Ÿæƒ…ã€‚
3. æ ¹æ®å¦è±¡çš„å‰å‡¶ï¼ˆ${result.final.name}ï¼‰ï¼Œç»™å‡ºæ˜ç¡®çš„è¡ŒåŠ¨å»ºè®®ï¼ˆè¯¥å†²è¿˜æ˜¯è¯¥ç¨³ï¼‰ã€‚
4. ç¯‡å¹…æ§åˆ¶åœ¨150å­—å·¦å³ï¼Œæ¡ç†æ¸…æ™°ã€‚`;
                
                try {
                    let text = "";
                    // ä½¿ç”¨ç”¨æˆ·é…ç½®çš„ API URL å’Œ Key
                    // æ³¨æ„ï¼šHiAPI å…¼å®¹ OpenAI æ¥å£æ ¼å¼ï¼Œæ‰€ä»¥è·¯å¾„ä¸º /chat/completions
                    const cleanBaseUrl = API_BASE_URL.replace(/\/$/, '');
                    const endpoint = `${cleanBaseUrl}/chat/completions`;

                    const res = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${DEFAULT_API_KEY}`
                        },
                        body: JSON.stringify({
                            // ä¿æŒä½¿ç”¨æ›´ç¨³å®šçš„ gpt-4o-mini
                            model: "gpt-4o-mini", 
                            messages: [
                                { role: "system", content: "ä½ æ˜¯ä¸€ä½ç²¾é€šå‘¨æ˜“æœ¯æ•°ã€å–„äºè§£å¦çš„å›½å­¦å¤§å¸ˆã€‚è¯·ç”¨é€šä¿—æ˜“æ‡‚çš„å¤§ç™½è¯ä¸ºç”¨æˆ·è§£æƒ‘ã€‚" },
                                { role: "user", content: prompt }
                            ],
                            temperature: 0.7
                        })
                    });
                    
                    if (!res.ok) {
                        const errData = await res.json().catch(() => ({}));
                        throw new Error(errData.error?.message || `è¯·æ±‚å¤±è´¥ ${res.status}`);
                    }
                    
                    const data = await res.json();
                    text = data.choices?.[0]?.message?.content;
                    
                    setAiAnalysis(text || "å¤§å¸ˆæ­£åœ¨æ²‰æ€ï¼Œè¯·ç¨åå†è¯•ã€‚");
                } catch (e) {
                    console.error(e);
                    setAiAnalysis(`è¿æ¥å¤§å¸ˆå¤±è´¥: ${e.message}`);
                }
                setAiLoading(false);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col relative">
                    {/* å¤´éƒ¨ */}
                    <header className="bg-[#1C1917] text-[#D4AF37] p-5 text-center z-10 sticky top-0 shadow-md">
                        <h1 className="text-xl font-bold flex justify-center items-center gap-2 tracking-widest">
                            <span className="text-2xl">â˜¯</span> å°å…­å£¬Â·çµæ„Ÿç¥è¯¾
                        </h1>
                    </header>

                    <main className="flex-1 p-5 overflow-y-auto pb-20">
                        {!result ? (
                            <div className="space-y-6 fade-in">
                                <div className="flex bg-stone-100 p-1 rounded-lg">
                                    <button onClick={() => setMode('general')} className={`flex-1 py-3 rounded-md text-sm font-bold transition-all ${mode === 'general' ? 'bg-white shadow text-stone-900' : 'text-stone-400'}`}>âœ¨ ä¸‡äº‹å‰å‡¶</button>
                                    <button onClick={() => setMode('lost')} className={`flex-1 py-3 rounded-md text-sm font-bold transition-all ${mode === 'lost' ? 'bg-white shadow text-stone-900' : 'text-stone-400'}`}>ğŸ” å¯»ç‰©æ‰¾å›</button>
                                </div>

                                <div>
                                    <label className="text-xs font-bold text-stone-500 ml-1 mb-1 block">å¿ƒä¸­æ‰€å¿µ (å¯é€‰)</label>
                                    <textarea 
                                        value={query} onChange={e => setQuery(e.target.value)}
                                        placeholder={mode === 'general' ? "ä»Šæ—¥è¿åŠ¿å¦‚ä½•ï¼Ÿæ­¤äº‹å¯æˆå¦ï¼Ÿ" : "é’¥åŒ™ä¸¢å“ªé‡Œäº†ï¼Ÿè¯ä»¶åœ¨å“ªé‡Œï¼Ÿ"}
                                        className="w-full p-4 bg-stone-50 rounded-xl border border-stone-200 focus:outline-none focus:ring-2 focus:ring-[#D4AF37]/50 h-24 resize-none text-sm"
                                    ></textarea>
                                </div>

                                <div className="flex border-b border-stone-200">
                                    <button onClick={() => setInputMethod('date')} className={`pb-2 px-4 text-sm font-bold border-b-2 transition-colors ${inputMethod === 'date' ? 'border-[#D4AF37] text-stone-800' : 'border-transparent text-stone-400'}`}>å†œå†èµ·å¦</button>
                                    <button onClick={() => setInputMethod('random')} className={`pb-2 px-4 text-sm font-bold border-b-2 transition-colors ${inputMethod === 'random' ? 'border-[#D4AF37] text-stone-800' : 'border-transparent text-stone-400'}`}>çµæ„Ÿéšæœº</button>
                                </div>

                                {inputMethod === 'date' && (
                                    <div className="space-y-3 animate-in fade-in slide-in-from-top-2 duration-300">
                                        <div className="relative">
                                            <label className="absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-stone-400">å†œå†æœˆä»½</label>
                                            <select value={lunarMonth} onChange={e => setLunarMonth(e.target.value)} className="w-full p-3 bg-white border border-stone-200 rounded-lg text-stone-700 font-medium focus:border-[#D4AF37] outline-none">
                                                {LUNAR_MONTHS.map((m, i) => <option key={i} value={i + 1}>{m}</option>)}
                                            </select>
                                        </div>
                                        
                                        <div className="relative">
                                            <label className="absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-stone-400">å†œå†æ—¥æœŸ</label>
                                            <select value={lunarDay} onChange={e => setLunarDay(e.target.value)} className="w-full p-3 bg-white border border-stone-200 rounded-lg text-stone-700 font-medium focus:border-[#D4AF37] outline-none">
                                                {LUNAR_DAYS.map((d, i) => <option key={i} value={i + 1}>{d}</option>)}
                                            </select>
                                        </div>

                                        <div className="relative">
                                            <label className="absolute -top-2 left-2 bg-white px-1 text-[10px] font-bold text-stone-400">å½“å‰æ—¶è¾°</label>
                                            <select value={hourIndex} onChange={e => setHourIndex(e.target.value)} className="w-full p-3 bg-white border border-stone-200 rounded-lg text-stone-700 font-medium focus:border-[#D4AF37] outline-none font-mono text-sm">
                                                {EARTHLY_BRANCHES.map((b, i) => (
                                                    <option key={i} value={i}>
                                                        {b.name} ({b.range})
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>
                                )}

                                {inputMethod === 'random' && (
                                    <div className="bg-stone-50 rounded-xl p-6 text-center border border-stone-100">
                                        <p className="text-sm text-stone-500 mb-2">ä¸‡ç‰©çš†æœ‰æ•°ï¼Œå¿ƒè¯šåˆ™çµ</p>
                                        <p className="text-xs text-stone-400">ç‚¹å‡»æµ‹ç®—ï¼Œç³»ç»Ÿå°†éšæœºæŠ“å–æ­¤åˆ»çš„æ—¶ç©ºæ•°ç†</p>
                                    </div>
                                )}

                                <button onClick={() => inputMethod === 'date' ? calculate(lunarMonth, lunarDay, hourIndex) : handleRandom()} disabled={loading} className="w-full bg-[#1C1917] text-[#D4AF37] py-4 rounded-xl font-bold text-lg shadow-xl shadow-stone-200 active:scale-[0.98] transition-all flex items-center justify-center gap-2 disabled:opacity-70">
                                    {loading ? <span className="animate-pulse">æ­£åœ¨æ¨æ¼”...</span> : <span>ğŸ”® å¼€å§‹æµ‹ç®—</span>}
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-6 fade-in pb-10">
                                <div className={`${result.final.bg} ${result.final.border} border-2 rounded-2xl p-6 text-center relative overflow-hidden shadow-sm`}>
                                    <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-black/10 to-transparent"></div>
                                    <div className="text-[10px] font-mono text-stone-400 mb-2 tracking-widest uppercase">Divination Result</div>
                                    <h2 className={`text-6xl font-black ${result.final.color} mb-2 font-serif`}>{result.final.name}</h2>
                                    
                                    <div className="flex justify-center gap-2 text-xs font-bold text-stone-500 mb-5">
                                        <span className="bg-white/50 px-2 py-1 rounded border border-stone-200">äº”è¡Œå±{result.final.element}</span>
                                        <span className="bg-white/50 px-2 py-1 rounded border border-stone-200">å‰å‡¶æŒ‡æ•°: {result.final.score}</span>
                                    </div>

                                    <div className="bg-white/70 backdrop-blur-sm rounded-lg p-4 italic text-stone-800 font-serif border border-stone-100 shadow-inner">
                                        "{result.final.poem}"
                                    </div>

                                    <div className="mt-4 pt-3 border-t border-black/5 text-[10px] text-stone-400 flex justify-center gap-2">
                                        <span>æœˆ:{result.month.name}</span>â†’
                                        <span>æ—¥:{result.day.name}</span>â†’
                                        <span className="font-bold text-stone-600">æ—¶:{result.final.name}</span>
                                    </div>
                                </div>

                                {/* AI åŒºåŸŸ */}
                                <div className="bg-gradient-to-br from-indigo-50 to-blue-50 border border-indigo-100 rounded-xl p-5 shadow-sm">
                                    <div className="flex justify-between items-center mb-3">
                                        <h3 className="font-bold text-indigo-900 flex items-center gap-2 text-sm">ğŸ¤– AI å¤©æœºè¯¦è§£</h3>
                                        {!aiAnalysis && !aiLoading && (
                                            <button onClick={callAI} className="text-xs bg-white hover:bg-indigo-50 px-3 py-1.5 rounded-full border border-indigo-200 text-indigo-600 font-medium transition-colors shadow-sm">
                                                ç‚¹å‡»è·å–å¤§å¸ˆè§£è¯»
                                            </button>
                                        )}
                                    </div>
                                    
                                    {aiLoading && (
                                        <div className="flex items-center justify-center py-4 text-indigo-400 gap-2 text-xs">
                                            <div className="w-2 h-2 bg-indigo-400 rounded-full animate-bounce"></div>
                                            <div className="w-2 h-2 bg-indigo-400 rounded-full animate-bounce delay-75"></div>
                                            <div className="w-2 h-2 bg-indigo-400 rounded-full animate-bounce delay-150"></div>
                                            å¤§å¸ˆæ­£åœ¨è¿æ¥å¤©æœº (éœ€è”ç½‘)...
                                        </div>
                                    )}
                                    
                                    {aiAnalysis && (
                                        <div className="text-sm text-indigo-900/80 leading-relaxed whitespace-pre-wrap font-serif animate-in fade-in">
                                            {aiAnalysis}
                                        </div>
                                    )}
                                </div>

                                <div className="bg-white border border-stone-200 rounded-xl p-5 shadow-sm">
                                    <h3 className="font-bold mb-3 text-stone-800 flex items-center gap-2 text-sm">
                                        <span className="text-[#D4AF37]">ğŸ“–</span> 
                                        {mode === 'general' ? 'å¤ç±é€šä¹‰' : 'å¯»ç‰©æŒ‡å¼•'}
                                    </h3>
                                    <p className="text-stone-600 text-sm leading-7 text-justify">
                                        {mode === 'general' ? result.final.desc : result.final.lost}
                                    </p>
                                </div>

                                <button onClick={() => { setResult(null); setAiAnalysis(''); }} className="w-full py-4 text-stone-400 hover:text-stone-600 text-sm font-medium flex items-center justify-center gap-2 transition-colors">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                                    é‡æ–°æµ‹ç®—
                                </button>
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>